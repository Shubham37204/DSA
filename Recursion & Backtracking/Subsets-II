"""
Problem: Subsets II

Statement:
Given an integer array nums that may contain duplicate elements, return all possible subsets (the power set).

- A subset is a selection of elements from the array (possibly empty).
- The solution set must not contain duplicate subsets.
- Subsets may be returned in any order.
- The input array may contain duplicates, but each subset in the output must be unique.

Return all possible unique subsets.
"""
class Solution:
    def subsetsWithDup(self, nums: List[int]) -> List[List[int]]:
        nums.sort()
        ans = []
        allSubsets = []

        def Subsets(arr, ans, i):
            if i == len(arr):
                allSubsets.append(ans.copy())
                return
            
            # include current element
            ans.append(arr[i])
            Subsets(arr, ans, i + 1)
            ans.pop()

            # skip duplicates
            idx = i + 1
            while idx < len(arr) and arr[idx] == arr[i]:
                idx += 1

            # exclude current element and its duplicates
            Subsets(arr, ans, idx)

        Subsets(nums, ans, 0)
        return allSubsets
